if (PHP_FOUND)
    set(PHP_FIND_QUIETLY TRUE)
endif ()

if (NOT PHP_FOUND)
    set(PHP_CONFIG_EXECUTABLE "php-config" CACHE FILEPATH "Path to php-config")
    if (PHP_CONFIG_EXECUTABLE)
        execute_process(COMMAND ${PHP_CONFIG_EXECUTABLE} --prefix OUTPUT_VARIABLE PHP_LIB_PREFIX OUTPUT_STRIP_TRAILING_WHITESPACE)
        execute_process(COMMAND ${PHP_CONFIG_EXECUTABLE} --includes OUTPUT_VARIABLE PHP_INCLUDES OUTPUT_STRIP_TRAILING_WHITESPACE)
        execute_process(COMMAND ${PHP_CONFIG_EXECUTABLE} --include-dir OUTPUT_VARIABLE PHP_INCLUDES_DIR OUTPUT_STRIP_TRAILING_WHITESPACE)
        execute_process(COMMAND ${PHP_CONFIG_EXECUTABLE} --libs OUTPUT_VARIABLE PHP_LIBS OUTPUT_STRIP_TRAILING_WHITESPACE)
        execute_process(COMMAND ${PHP_CONFIG_EXECUTABLE} --version OUTPUT_VARIABLE PHP_VERSION OUTPUT_STRIP_TRAILING_WHITESPACE)
        execute_process(COMMAND ${PHP_CONFIG_EXECUTABLE} --vernum OUTPUT_VARIABLE ZEND_API OUTPUT_STRIP_TRAILING_WHITESPACE)
        execute_process(COMMAND ${PHP_CONFIG_EXECUTABLE} --extension-dir OUTPUT_VARIABLE PHP_EXTENSION_DIR OUTPUT_STRIP_TRAILING_WHITESPACE)
        execute_process(COMMAND ${PHP_CONFIG_EXECUTABLE} --ini-path OUTPUT_VARIABLE PHP_INI_DIR OUTPUT_STRIP_TRAILING_WHITESPACE)
        get_filename_component(PHP_LIB_DIR ${PHP_LIBS} DIRECTORY)
        string(REGEX REPLACE "-I" "" PHP_INCLUDES "${PHP_INCLUDES}")
        string(REGEX REPLACE " " ";" PHP_INCLUDES "${PHP_INCLUDES}")
        set(PHP_LDFLAGS "-L${PHP_LIB_DIR} ${PHP_LIBS}")
        set(PHP_FOUND 1)
    endif ()
endif ()

message(STATUS "PHP version: ${PHP_VERSION} ${PHP_INCLUDES}")